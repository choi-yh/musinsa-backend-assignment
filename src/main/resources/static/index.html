<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Musinsa Backend Assignment</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        /* 테이블 스타일 */
        table {
            border-collapse: collapse; /* 테이블 테두리 겹치지 않도록 설정 */
            width: 50%; /* 테이블 넓이 100%로 설정 */
        }

        th, td {
            border: 1px solid #dddddd; /* 테두리 설정 */
            text-align: left; /* 텍스트 왼쪽 정렬 */
            padding: 8px; /* 셀 안쪽 여백 추가 */
        }

        th {
            background-color: #f2f2f2; /* 헤더 배경색 */
        }
    </style>
</head>

<body>
<h1>API 테스트 페이지</h1>

<!-- 상품 목록을 위한 섹션 -->
<div>
    <h2>상품 목록</h2>
    <div id="product-list">
        <!-- 상품 테이블이 이곳에 렌더링됩니다 -->
    </div>
</div>

<div>
    <h2>구현 1) - 카테고리 별 최저가격 브랜드와 상품 가격, 총액을 조회하는 API</h2>
    <button onclick="fetchLowestPriceBrandByCategory()">구현1</button>
    <pre id="result-1"></pre>
</div>

<div>
    <h2>구현 2) - 단일 브랜드로 모든 카테고리 상품을 구매할 때 최저가격에 판매하는 브랜드와 카테고리의 상품가격, 총액을
        조회하는 API</h2>
    <button onclick="fetchLowestPriceByBrand()">구현2</button>
    <pre id="result-2"></pre>
</div>

<div>
    <h2>구현 3) - 카테고리 이름으로 최저, 최고 가격 브랜드와 상품 가격을 조회하는 API</h2>
    <input type="text" id="category-input" placeholder="카테고리 입력">
    <button onclick="fetchLowestHighestBrandByCategory()">구현3</button>
    <pre id="result-3"></pre>
</div>

<script src="/js/main.js"></script>
<script>
    // 페이지 로드 시 상품 데이터를 자동으로 불러와 테이블을 생성
    window.onload = function () {
        fetchProducts();
    };

    async function fetchProducts() {
        try {
            const response = await fetch('/api/v1/admin/products');
            const data = await response.json();
            renderProductTable(data);
        } catch (error) {
            document.getElementById('product-list').textContent = 'Error: ' + error.message;
        }
    }

    function renderProductTable(data) {
        // HTML 테이블 요소 생성
        const table = document.createElement('table');
        table.setAttribute('border', '1'); // 테이블 테두리 설정

        // 카테고리 목록을 추출
        const categories = [...new Set(data.map(product => product.category))];
        // 브랜드 목록을 추출
        const brands = [...new Set(data.map(product => product.brand_name))];

        // 테이블 헤더 생성
        const headerRow = document.createElement('tr');
        headerRow.appendChild(document.createElement('th')); // 왼쪽 상단 빈 셀 추가

        // 카테고리 헤더 추가
        categories.forEach(category => {
            const th = document.createElement('th');
            th.innerText = category;
            headerRow.appendChild(th);
        });
        table.appendChild(headerRow);

        // 브랜드별로 가격을 추가한 행 생성
        brands.forEach(brand => {
            const row = document.createElement('tr');
            const brandCell = document.createElement('td');
            brandCell.innerText = brand; // 브랜드명 추가
            row.appendChild(brandCell);

            // 각 카테고리별 가격 추가
            categories.forEach(category => {
                // 해당 브랜드와 카테고리의 가격 찾기
                const product = data.find(p => p.brand_name === brand && p.category === category);
                const priceCell = document.createElement('td');
                priceCell.innerText = product ? product.price : '-'; // 가격 또는 'N/A' 추가
                row.appendChild(priceCell);
            });
            table.appendChild(row);
        });

        // 기존 테이블을 제거하고 새 테이블을 문서에 추가
        const productListDiv = document.getElementById('product-list');
        productListDiv.innerHTML = '';  // 기존 내용을 지우고
        productListDiv.appendChild(table);
    }
</script>
</body>

</html>
